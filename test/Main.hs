{-# LANGUAGE OverloadedStrings #-}
module Main (main) where

import Data.Encoding.Bottom (encode, unBottom)
import Data.Text (Text)
import qualified Data.Text as T
import Data.Text.Encoding (encodeUtf8)
import Test.Hspec (Expectation, describe, hspec, it, shouldBe)

-- Why does this cause GHC to return an error? Related to https://gitlab.haskell.org/ghc/ghc/-/issues/5518?
twoHundred :: Text
twoHundred = T.singleton '\129730'

testEncode :: Text -> Text -> Expectation
testEncode text bottom = unBottom (encode text) `shouldBe` encodeUtf8 bottom

main :: IO ()
main = hspec $ do
  -- Taken from https://github.com/bottom-software-foundation/bottom-rs/blob/need_top/src/bottom.rs
  describe "Data.Encoding.Bottom" $ do
    it "encodes strings" $ do
      testEncode "Test" "ğŸ’–âœ¨âœ¨âœ¨,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨ğŸ¥ºğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨ğŸ¥º,ğŸ‘‰ğŸ‘ˆ"
      testEncode "h" "ğŸ’–ğŸ’–,,,,ğŸ‘‰ğŸ‘ˆ"
      testEncode "ğŸ¥º" $ twoHundred <> "âœ¨âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–ğŸ¥º,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–âœ¨ğŸ¥ºğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–âœ¨âœ¨âœ¨ğŸ¥º,ğŸ‘‰ğŸ‘ˆ"
      testEncode "ãŒã‚“ã°ã‚Œ" $
        twoHundred
          <> "âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨ğŸ¥º,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆ"
          <> twoHundred
          <> "âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆ"
          <> twoHundred
          <> "âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨ğŸ¥º,,,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–ğŸ’–âœ¨âœ¨ğŸ¥º,ğŸ‘‰ğŸ‘ˆ"
          <> twoHundred
          <> "âœ¨âœ¨ğŸ¥º,,ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆğŸ’–ğŸ’–âœ¨âœ¨âœ¨âœ¨ğŸ‘‰ğŸ‘ˆ"
